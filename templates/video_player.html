<html>
<head>
  <title>Video Player - {{ context['title'] }}</title>
</head>

<body class='bg-black'>
  {% extends "navbar.html" %}
  {% block content %}

  <!-- Search Bar -->
  <div class='flex items-center justify-center max-w-[1200px] mx-auto mt-4'>
    <div class='w-full'>
      {% include "search_bar.html" %}
    </div>
  </div>

  <!-- Anime & Episode Info -->
  <div class='text-white flex flex-col items-center text-left gap-4 mt-4'>
    <h1 class="text-[#b3aca2]">
      Watching {{ context['title'] }} Episode: <span class="episode-num">{{ context['cur_ep_id'] }}</span>
    </h1>
    <h1 class="text-[#b3aca2]">
      Total Episodes: <span class="total-episode-num">{{ context['episodes'] }}</span>
    </h1>
  </div>

  <!-- Video Player -->
  <div class="anime_video_body_watch_items load flex items-center justify-center p-10">
    <div class="play-video">
      <iframe src="{{ context['video_feed'] }}" class="w-[1300px] h-[800px] border-4 border-red-600 overflow-hidden" allowfullscreen="true"></iframe>
    </div>
  </div>

  <!-- Navigation -->
  <div class="flex justify-center items-center mb-5">
    <nav aria-label="Page navigation">
      <ul class="flex list-style-none text-white gap-4">
        <li>
          {% if context['cur_ep_id'] > 1 %}
            {% set prev_ep = (context['cur_ep_id'] - 1)|string|replace('.', '-') %}
            <a href="{{ url_for('video', anime_name=context['anime_name'], ep_num=prev_ep) }}">Prev</a>
          {% else %}
            <span class="opacity-50 cursor-not-allowed">Prev</span>
          {% endif %}
        </li>
        <li>Episode {{ context['cur_ep_id'] }} / {{ context['episodes'] }}</li>
        <li>
          {% if context['cur_ep_id'] < context['episodes'] %}
            {% set next_ep = (context['cur_ep_id'] + 1)|string|replace('.', '-') %}
            <a href="{{ url_for('video', anime_name=context['anime_name'], ep_num=next_ep) }}">Next</a>
          {% else %}
            <span class="opacity-50 cursor-not-allowed">Next</span>
          {% endif %}
        </li>
      </ul>
    </nav>
  </div>

  <!-- Episode Buttons -->
  <div class='flex flex-col items-center justify-center p-6'>
    <div class="grid grid-cols-12 gap-3">
      {% for ep in context.get('episode_links', []) %}
        {% set ep_num_str = ep['num']|string %}
        {% if ep['num'] % 1 != 0 %}
          {% set ep_num_str = ep_num_str|replace('.', '-') %}
        {% endif %}

        <a href="{{ url_for('video', anime_name=context['anime_name'], ep_num=ep_num_str) }}">
          <button class="bg-[#18191a] text-white w-[60px] p-2 rounded-xl hover:bg-red-400 hover:text-black transition-all ease-in-out duration-300">
            <span class="{% if ep['num'] <= context.get('last_watched_ep', 0) %}text-gray-500{% else %}text-emerald-500 font-bold{% endif %}">
              {{ ep['num'] }}
            </span>
          </button>
        </a>
      {% endfor %}
    </div>
  </div>

  {% include "footer.html" %}
  <script src="{{ url_for('static', filename='scripts.js') }}"></script>
  {% endblock %}
</body>
</html>
